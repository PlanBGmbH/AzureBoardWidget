<!DOCTYPE html>
    <html>
        <head>          
            <script src="node_modules\vss-web-extension-sdk\lib\VSS.SDK.min.js"></script>
            <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js">
                VSS.init({                        
                    explicitNotifyLoaded: true,
                    usePlatformStyles: true
                });
        
                VSS.require("TFS/Dashboards/WidgetHelpers", function (WidgetHelpers) {
                    WidgetHelpers.IncludeWidgetStyles();
                    VSS.register("HelloWorldWidget", function () {                
                        return {
                            load: function (widgetSettings) {
                                let i = 0;
    
    var countSucc = 0;
    var countFailed = 0;
    var countNotDep = 0;

    //Connecting to the ZEISS API with an Security Token
    var myPAT = ""; //Key is Ending March 2021
    var myOrg = "ZEISSgroup";
    var base64Pat = btoa(":" + myPAT);
    var request = new XMLHttpRequest;
    request.open("GET", "https://vsrm.dev.azure.com/" + myOrg + "/ZEISS%20IQS%20Smart%20Services%20Dashboard/_apis/release/deployments?api-version=5.1", true);
    var b = "Basic " + base64Pat;
    request.setRequestHeader("Authorization", b);

    //Function that goes through the API
    request.onload = function () {
      debugger;
      var data = JSON.parse(this.response);
      console.log(data);
      for (i = 0; i < data.value.length; i++) {
        //console.log(data.value[i])

        if (data.value[i].deploymentStatus == "succeeded") { //Checks for Items with Name: "deploymentStatus " checks for its condition
          countSucc++;
        }
        else if (data.value[i].deploymentStatus == "failed") {
          countFailed++;
        }
        else if (data.value[i].deploymentStatus == "notDeployed") {
          countNotDep++;
        }
      }
      //Calculating percentage of successful deployments
      let percentage = countSucc * 100 / i;

// Load google charts
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

// Draw the chart and set the chart values
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
        ['Task', 'Hours per Day'],
        ['Succeeded', countSucc],
        ['Failed', countFailed],
        ['Not Deployed', countNotDep]
        ]);

        // Optional; add a title and set the width and height of the chart
        var options = {'title':'Deployments', 'width':500, 'height':400};

        // Display the chart inside the <div> element with id="piechart"
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
        }
    }
    request.send();
        
                                return WidgetHelpers.WidgetStatusHelper.Success();
                            }
                        }
                    });
                    VSS.notifyLoadSucceeded();
                });
            </script>
        </head>
        <body>
            <div id="piechart"></div>
        </body>
    </html>
